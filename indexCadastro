import { useState } from 'react'
import { View, Text, StyleSheet, TouchableOpacity, TextInput } from 'react-native';
import { db } from '../../firebaseConnection'; // corrigido
import { collection, addDoc } from 'firebase/firestore'

export default function Cadastro() {
  const [nome, setNome] = useState("");
  const [email, setEmail] = useState("");
  const [cargo, setCargo] = useState("");
  const [showForm, setShowForm] = useState(true);

  async function handleRegister(){
    try {
      await addDoc(collection(db, "users"), {
        nome,
        email,
        cargo,
      });
      console.log("CADASTRADO COM SUCESSO");
      setNome("");
      setEmail("");
      setCargo("");
    } catch (err) {
      console.log(err);
    }
  }

  function handleToggle(){
    setShowForm(!showForm);
  }

  return (
    <View style={styles.container}>
      { showForm && (
        <View>
          <Text style={styles.label}>Nome:</Text>
          <TextInput
            style={styles.input}
            placeholder="Digite seu nome..."
            value={nome}
            onChangeText={setNome} 
          />

          <Text style={styles.label}>Email:</Text>
          <TextInput
            style={styles.input}
            placeholder="Digite seu email..."
            value={email}
            onChangeText={setEmail} 
          />

          <Text style={styles.label}>Cargo:</Text>
          <TextInput
            style={styles.input}
            placeholder="Digite o seu cargo..."
            value={cargo}
            onChangeText={setCargo} 
          />

          <TouchableOpacity style={styles.button} onPress={handleRegister}>
            <Text style={styles.buttonText}>Adicionar</Text>
          </TouchableOpacity>
        </View>
      )}

      <TouchableOpacity onPress={handleToggle} style={{ marginTop: 8}}>
        <Text style={{ textAlign:"center", color: "#000" }}>
          {showForm ? "Esconder formulário" : "Mostrar formulário"}
        </Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container:{ flex:1, paddingTop: 40 },
  button:{ backgroundColor: "#000", marginLeft: 8, marginRight: 8 },
  buttonText:{ padding: 8, color: "#FFF", textAlign: 'center' },
  label:{ color: "#000", fontSize: 18, marginBottom: 4, marginLeft: 8 },
  input:{ borderWidth: 1, marginLeft: 8, marginRight: 8, marginBottom: 8 }
});
